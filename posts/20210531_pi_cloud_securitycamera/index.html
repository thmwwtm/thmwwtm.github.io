<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cloud security camera with a Raspberry Pi - The hungarian man who went to Malta</title><meta name=keywords content="malta,security,smb,samba,camera,cctv,raspberry,pi,cloud,storage"><meta name=description content="Preface, motivation Coming from the middle of Europe I am used to buildings prepared for cold, warm, and burglars. Meaning doors and windows are able to close tightly probably having multiple layers of insulation and other than breaking the glass in the window (what is probably not even close to glass anymore but a quite resistant plastic something).
Malta situation Construction Then welcome to Malta where buildings are prepared only for the warm."><meta name=author content="Me"><link rel=canonical href=https://thmwwtm.github.io/posts/20210531_pi_cloud_securitycamera/><link href=https://thmwwtm.github.io/assets/css/stylesheet.min.e855f825213afc7aacdf334a190f4ccef15ec9f889837b681633bd7ab2d3f3d8.css integrity="sha256-6FX4JSE6/Hqs3zNKGQ9MzvFeyfiJg3toFjO9erLT89g=" rel="preload stylesheet" as=style><link rel=icon href=https://thmwwtm.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thmwwtm.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://thmwwtm.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://thmwwtm.github.io/apple-touch-icon.png><link rel=mask-icon href=https://thmwwtm.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=/css/cookie.css><script type=application/javascript>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes",GA_SESSION_STORAGE_KEY;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,window.sessionStorage&&(GA_SESSION_STORAGE_KEY='ga:clientId',ga('create','UA-184738555-1',{storage:'none',clientId:sessionStorage.getItem(GA_SESSION_STORAGE_KEY)}),ga(function(a){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,a.get('clientId'))})),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Cloud security camera with a Raspberry Pi"><meta property="og:description" content="Preface, motivation Coming from the middle of Europe I am used to buildings prepared for cold, warm, and burglars. Meaning doors and windows are able to close tightly probably having multiple layers of insulation and other than breaking the glass in the window (what is probably not even close to glass anymore but a quite resistant plastic something).
Malta situation Construction Then welcome to Malta where buildings are prepared only for the warm."><meta property="og:type" content="article"><meta property="og:url" content="https://thmwwtm.github.io/posts/20210531_pi_cloud_securitycamera/"><meta property="article:published_time" content="2021-05-31T09:02:00+02:00"><meta property="article:modified_time" content="2021-05-31T09:02:00+02:00"><meta property="og:site_name" content="The hungarian man who went to Malta"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cloud security camera with a Raspberry Pi"><meta name=twitter:description content="Preface, motivation Coming from the middle of Europe I am used to buildings prepared for cold, warm, and burglars. Meaning doors and windows are able to close tightly probably having multiple layers of insulation and other than breaking the glass in the window (what is probably not even close to glass anymore but a quite resistant plastic something).
Malta situation Construction Then welcome to Malta where buildings are prepared only for the warm."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cloud security camera with a Raspberry Pi","name":"Cloud security camera with a Raspberry Pi","description":"Preface, motivation Coming from the middle of Europe I am used to buildings prepared for cold, warm, and burglars. Meaning doors and windows are able to close tightly probably …","keywords":["malta","security","smb","samba","camera","cctv","raspberry","pi","cloud","storage"],"articleBody":"Preface, motivation Coming from the middle of Europe I am used to buildings prepared for cold, warm, and burglars. Meaning doors and windows are able to close tightly probably having multiple layers of insulation and other than breaking the glass in the window (what is probably not even close to glass anymore but a quite resistant plastic something).\nMalta situation Construction Then welcome to Malta where buildings are prepared only for the warm. Meaning closed doors and windows are not stopping the wind, central heating is not existing.\nNow stopping the cold from getting in is not what I want to brag about, but you can imagine a window or terrace door with a visible gap when closed, and no or really weak locking mechanism, is not really stopping an unauthorized someone to come in either.\nPublic safety You don’t really hear about crimes in Malta, you don’t really see people on the street who makes you feel unsafe. Policemen are going around by car, by motorbike, on foot. So why would you bother making your window unbreakable when no one wants to break it right?\n Story time Our front balcony is facing the street it is above a garage. You won’t reach it if you are not incredibly tall or put extra effort into jumping high. We were worried about having that light balcony doors there, but according to public safety we let it go.\nUntil one night we woke up to our dog’s barking. He basically never barks. So it was quite surprising, and he was staring out to the front balcony. We thought someone climbed up and tried to break in. So for quick remediation, we thought buying a security camera would be a good idea.\nFun fact Later it turned out probably our dog was barking on something totally irrelevant, we saw him once staring the same way out that window growling (last phase before barking) on an empty chips bag blown by the wind.\n Security system 1.0.4 The camera So I ordered this little guy: Xiaomi Mi Home Security Camera 360 I wanted something affordable, and I wanted to able to save the recordings to the cloud or other server. If you create a Mi account and pay a bit for a subscription you have all that in Xiaomi’s cloud solution. Other than that, you can configure the device to save recordings to a NAS.\nThe camera itself can take a 64GB microSD card, but you don’t need to be the sharpest burglar to pick up the camera too, and boom my recordings are gone.\nThe NAS Of course, I don’t want to pay for a Mi cloud, and of course, I want to hack some monstrosity together, I have a Raspberry running already, blocking ads for me, thanks to  pi-hole   and it should have enough space for some archive recordings.\nAnd you are Bamboozled! Yep, the sd card I used initially is not having too much free space, so I plugged a big enough USB drive into the pi, made it mount automatically on start, and configured it as an smb drive.\nAdding samba to Linux This tutorial explains everything, installing and configuring the shared folder, even mounting the pendrive on startup. One thing is missing:\nAdding the samba user If you created the folder shared with a specific user you won’t be able to write through samba only if the samba login is the same user or the permissions are unsafe. By the way, I tried chmod 777 and I was still not able to write the folder from outside. So when you connect to smb from the other device you should be able to connect as the user with the same name so writing the folder is possible with 700 or 744 rights. To add the user to samba use\n smbpasswd -a  this will ask for creating the password and adds this user to samba. It does not care about the username, it is just a string for samba, it does not check if it is a real linux user or not, but in that case, you won’t be able to use that user for too much, so make sure you provide the right user which owns the shared folder.\nThe cloud A basic burglar will take the camera, a clever one may notice the Raspberry and take that one too. So to keep the recordings safe they should be saved somewhere outside the house. At first I was thinking about using Dropbox or Google Drive probably they are the most popular but searching a bit for the best or easiest experience on linux I quickly realized I will choose something else. I read Mega has apps for all platforms, so I went ahead and tried it out, and boy, what a positive surprise. Easy signup, simple install, straightforward config, nice UI on all devices. Probably from the whole setup adding the cloud sync took the least time.\nOne thing to keep an eye on, when you join Mega, you get a bonus for everything, literally everything. Registering, installing the desktop app, installing the mobile app, and quickly your 15GB storage is 85GB but this bonus is limited in time. If you are not careful and you are using over 15GB when the bonuses expire who knows, you lose data or you pay. By the way, you can use this link if you want to use Mega: https://mega.nz/aff=SKon_MBjW6w so I will get some credits to increase my storage a bit longer.\nWrapping up After all this, you can check the storage setup in the camera app. Go to the NAS option (assuming the camera and the pi is on the same network), the smb folder should show up. Add the credentials you set up. I chose to save one week of recordings to the NAS, the camera takes care of deleting the old files. I also set it up to record only when motion is detected. This way it can fit the 8GB pendrive I added, the biggest the folder got is 7.3GB to date, but usually, it is under 7 closer to 6. Since the shared folder cannot go over 8GB this will never reach the storage limit.\nYou may notice the version number 1.0.4 in the title, yes this was also a bit of try and fail mostly around the user and permissions.\n","wordCount":"1065","inLanguage":"en","datePublished":"2021-05-31T09:02:00+02:00","dateModified":"2021-05-31T09:02:00+02:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://thmwwtm.github.io/posts/20210531_pi_cloud_securitycamera/"},"publisher":{"@type":"Organization","name":"The hungarian man who went to Malta","logo":{"@type":"ImageObject","url":"https://thmwwtm.github.io/favicon.ico"}}}</script></head><body class=single id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://thmwwtm.github.io/ accesskey=h>Thmwwtm</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Cloud security camera with a Raspberry Pi</h1><div class=post-meta>May 31, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary><div class=details accesskey=c>Table of Contents</div></summary><blockquote><ul><ul><li><a href=#preface-motivation aria-label="Preface, motivation">Preface, motivation</a><ul><li><a href=#malta-situation aria-label="Malta situation">Malta situation</a><ul><li><a href=#construction aria-label=Construction>Construction</a></li><li><a href=#public-safety aria-label="Public safety">Public safety</a></li></ul></li></ul></li><li><a href=#story-time aria-label="Story time">Story time</a><ul><li><a href=#fun-fact aria-label="Fun fact">Fun fact</a></li></ul></li></ul><li><a href=#security-system-104 aria-label="Security system 1.0.4">Security system 1.0.4</a><ul><li><a href=#the-camera aria-label="The camera">The camera</a></li><li><a href=#the-nas aria-label="The NAS">The NAS</a><ul><ul><li><a href=# aria-label=pi-hole>pi-hole</a></li></ul><li><a href=#adding-samba-to-linux aria-label="Adding samba to Linux">Adding samba to Linux</a><ul><li><a href=#adding-the-samba-user aria-label="Adding the samba user">Adding the samba user</a></li></ul></li></ul></li><li><a href=#the-cloud aria-label="The cloud">The cloud</a></li><li><a href=#wrapping-up aria-label="Wrapping up">Wrapping up</a></li></ul></li></ul></blockquote></details></div><div class=post-content><h2 id=preface-motivation>Preface, motivation<a hidden class=anchor aria-hidden=true href=#preface-motivation>#</a></h2><p>Coming from the middle of Europe I am used to buildings prepared for cold, warm, and burglars. Meaning doors and windows are able to close tightly probably having multiple layers of insulation and other than breaking the glass in the window (what is probably not even close to glass anymore but a quite resistant plastic something).</p><h3 id=malta-situation>Malta situation<a hidden class=anchor aria-hidden=true href=#malta-situation>#</a></h3><h4 id=construction>Construction<a hidden class=anchor aria-hidden=true href=#construction>#</a></h4><p>Then welcome to Malta where buildings are prepared only for the warm. Meaning closed doors and windows are not stopping the wind, central heating is not existing.</p><p>Now stopping the cold from getting in is not what I want to brag about, but you can imagine a window or terrace door with a visible gap when closed, and no or really weak locking mechanism, is not really stopping an unauthorized someone to come in either.</p><h4 id=public-safety>Public safety<a hidden class=anchor aria-hidden=true href=#public-safety>#</a></h4><p>You don&rsquo;t really hear about crimes in Malta, you don&rsquo;t really see people on the street who makes you feel unsafe.
Policemen are going around by car, by motorbike, on foot. So why would you bother making your window unbreakable when no one wants to break it right?</p><blockquote><h2 id=story-time>Story time<a hidden class=anchor aria-hidden=true href=#story-time>#</a></h2><p>Our front balcony is facing the street it is above a garage. You won&rsquo;t reach it if you are not incredibly tall or put extra effort into jumping high. We were worried about having that light balcony doors there, but according to <a href=#public-safety>public safety</a> we let it go.<br><br>Until one night we woke up to our dog&rsquo;s barking. He basically never barks. So it was quite surprising, and he was staring out to the front balcony. We thought someone climbed up and tried to break in.
So for quick remediation, we thought buying a security camera would be a good idea.</p><h3 id=fun-fact>Fun fact<a hidden class=anchor aria-hidden=true href=#fun-fact>#</a></h3><p>Later it turned out probably our dog was barking on something totally irrelevant, we saw him once staring the same way out that window growling (last phase before barking) on an empty chips bag blown by the wind.</p></blockquote><h1 id=security-system-104>Security system 1.0.4<a hidden class=anchor aria-hidden=true href=#security-system-104>#</a></h1><h2 id=the-camera>The camera<a hidden class=anchor aria-hidden=true href=#the-camera>#</a></h2><p>So I ordered this little guy: <a href=https://www.mi.com/global/camera-360/>Xiaomi Mi Home Security Camera 360</a>
I wanted something affordable, and I wanted to able to save the recordings to the cloud or other server.
If you create a Mi account and pay a bit for a subscription you have all that in Xiaomi&rsquo;s cloud solution.
Other than that, you can configure the device to save recordings to a NAS.</p><p>The camera itself can take a 64GB microSD card, but you don&rsquo;t need to be the sharpest burglar to pick up the camera too, and boom my recordings are gone.</p><h2 id=the-nas>The NAS<a hidden class=anchor aria-hidden=true href=#the-nas>#</a></h2><p>Of course, I don&rsquo;t want to pay for a Mi cloud, and of course, I want to hack some monstrosity together, I have a Raspberry running already, blocking ads for me, thanks to<figure><a href=https://pi-hole.net/><img src="https://avatars.githubusercontent.com/u/16827203?s=200&v=4"></a><figcaption><h4>pi-hole</h4></figcaption></figure>and it should have enough space for some archive recordings.<br><br>And you are <a href=https://youtu.be/qPFTT7h6voo>Bamboozled</a>! Yep, the sd card I used initially is not having too much free space, so I plugged a big enough USB drive into the pi, made it mount automatically on start, and configured it as an smb drive.</p><h3 id=adding-samba-to-linux>Adding samba to Linux<a hidden class=anchor aria-hidden=true href=#adding-samba-to-linux>#</a></h3><p><a href=https://howtoraspberrypi.com/create-a-nas-with-your-raspberry-pi-and-samba/>This</a> tutorial explains everything, installing and configuring the shared folder, even mounting the pendrive on startup. One thing is missing:</p><h4 id=adding-the-samba-user>Adding the samba user<a hidden class=anchor aria-hidden=true href=#adding-the-samba-user>#</a></h4><p>If you created the folder shared with a specific user you won&rsquo;t be able to write through samba only if the samba login is the same user or the permissions are unsafe. By the way, I tried <code>chmod 777</code> and I was still not able to write the folder from outside.
So when you connect to smb from the other device you should be able to connect as the user with the same name so writing the folder is possible with 700 or 744 rights.
To add the user to samba use</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>&gt; smbpasswd -a &lt;username_here&gt;
</code></pre></div><p>this will ask for creating the password and adds this user to samba. It does not care about the <code>username</code>, it is just a string for samba, it does not check if it is a real linux user or not, but in that case, you won&rsquo;t be able to use that user for too much, so make sure you provide the right user which owns the shared folder.</p><h2 id=the-cloud>The cloud<a hidden class=anchor aria-hidden=true href=#the-cloud>#</a></h2><p>A basic burglar will take the camera, a clever one may notice the Raspberry and take that one too. So to keep the recordings safe they should be saved somewhere outside the house.
At first I was thinking about using Dropbox or Google Drive probably they are the most popular but searching a bit for the best or easiest experience on linux I quickly realized I will choose something else.
I read Mega has apps for all platforms, so I went ahead and tried it out, and boy, what a positive surprise. Easy signup, simple install, straightforward config, nice UI on all devices. Probably from the whole setup adding the cloud sync took the least time.</p><p>One thing to keep an eye on, when you join Mega, you get a bonus for everything, literally everything. Registering, installing the desktop app, installing the mobile app, and quickly your 15GB storage is 85GB but this bonus is limited in time. If you are not careful and you are using over 15GB when the bonuses expire who knows, you lose data or you pay.
By the way, you can use this link if you want to use Mega: <a href="https://mega.nz/aff=SKon_MBjW6w">https://mega.nz/aff=SKon_MBjW6w</a> so I will get some credits to increase my storage a bit longer.</p><h2 id=wrapping-up>Wrapping up<a hidden class=anchor aria-hidden=true href=#wrapping-up>#</a></h2><p>After all this, you can check the storage setup in the camera app. Go to the NAS option (assuming the camera and the pi is on the same network), the smb folder should show up. Add the credentials you set up. I chose to save one week of recordings to the NAS, the camera takes care of deleting the old files. I also set it up to record only when motion is detected. This way it can fit the 8GB pendrive I added, the biggest the folder got is 7.3GB to date, but usually, it is under 7 closer to 6. Since the shared folder cannot go over 8GB this will never reach the storage limit.</p><p>You may notice the version number 1.0.4 in the title, yes this was also a bit of try and fail mostly around the user and permissions.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://thmwwtm.github.io/tags/malta>malta</a></li><li><a href=https://thmwwtm.github.io/tags/security>security</a></li><li><a href=https://thmwwtm.github.io/tags/smb>smb</a></li><li><a href=https://thmwwtm.github.io/tags/samba>samba</a></li><li><a href=https://thmwwtm.github.io/tags/camera>camera</a></li><li><a href=https://thmwwtm.github.io/tags/cctv>cctv</a></li><li><a href=https://thmwwtm.github.io/tags/raspberry>raspberry</a></li><li><a href=https://thmwwtm.github.io/tags/pi>pi</a></li><li><a href=https://thmwwtm.github.io/tags/cloud>cloud</a></li><li><a href=https://thmwwtm.github.io/tags/storage>storage</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://thmwwtm.github.io/>The hungarian man who went to Malta</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top" accesskey=g><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a><div class=cookie-container><p>No cookies, however Google Analytics is used on this website to know what is happening, but only if you are not against it.</p><button class=cookie-btn>
Okay</button></div><script src=/js/cookie.js></script><script defer src=https://thmwwtm.github.io/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(a){a.preventDefault();var b=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(b)}']`).scrollIntoView({behavior:"smooth"})})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>